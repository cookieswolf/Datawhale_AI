# **Datawhale AI夏令营 大模型理解结构化表格数据（列车信息表）学习笔记**

## **一、核心目标**
构建一个能够**理解结构化表格数据**并回答自然语言问题的AI模型，主要应用于列车时刻表等结构化数据的查询与分析。

---

## **二、关键技术**
### **1. 大语言模型（LLM）基础**
- **API调用**：如何通过API与大模型交互（如硅基流动、Qwen3-8B）。  
- **Prompt工程**：设计有效的提示词，引导模型输出期望答案。  

### **2. 参数高效微调**
- **LoRA（低秩适配）**：仅调整少量参数，降低计算成本，适合资源有限的情况。  
- **全量微调**：调整所有参数，效果更好但计算开销大。  

### **3. 数据集构建（Pandas）**
- **数据读取与清洗**：`pd.read_excel()`、`fillna()`处理缺失值。  
- **数据筛选**：`loc`、`iloc`、布尔索引提取特定数据。  
- **时间处理**：标准化时间格式（如`"23:40:00"`→`"23:40"`）。  

---

## **三、典型问题类型**
| 问题类型 | 示例 |
|----------|------|
| **单字段查询** | "Z152次列车的终到站是哪里？" |
| **多条件筛选** | "在综合候车厅、发车时间晚于08:00的列车有哪些？" |
| **跨行计算** | "从兰州到北京西，哪趟车运行时间最短？" |
| **时间推理** | "K420次列车在兰州站的停留时长是多久？" |
| **缺失数据处理** | "检票口为5B且开点时间缺失的车次有哪些？" |

---

## **四、实现方案**
### **1. 数据预处理**
- 填充缺失值（如`"无数据"`）。  
- 删除无关列（如"序号"）。  
- 标准化时间格式。  

### **2. 问题生成**
- **编程生成问题**（确保准确性）：  
  ```python
  def create_question_list(row):
      questions = [
          f"{row['车次']}次列车的终到站是哪里？",
          f"{row['车次']}次列车的检票口是哪个？",
          f"{row['车次']}次列车的候车厅在哪里？"
      ]
      return questions
  ```

### **3. 答案生成（教师模型）**
- 使用更强的LLM（如Qwen3-8B）生成答案。  
- **Prompt示例**：
  ```
  给定列车信息：{车次: "K4547/6", 终到站: "佳木斯", ...}  
  问题：K4547/6次列车的终到站是哪里？  
  请生成JSON格式的答案：{"instruction": "问题", "output": "答案"}  
  ```

### **4. 模型微调**
- 使用Alpaca格式数据集：
  ```json
  {
      "instruction": "Z152次列车的终到站是哪里？",
      "output": "Z152次列车的终到站是北京西。"
  }
  ```

---

## **五、优化方向**
### **1. 提升问题多样性**
- 增加**跨行计算**（如运行时间比较）。  
- 增加**时间推理**（如延误时间计算）。  

### **2. 答案质量优化**
- **多模型验证**：用GPT-4、Claude等验证答案。  
- **人工修正**：对复杂问题的答案进行人工校对。  

### **3. 性能优化**
- **模型蒸馏**：用小模型模仿大模型行为，提升速度。  
- **动态Prompt优化**：根据不同问题类型调整Prompt结构。  

---

## **六、关键代码**
### **1. 数据清洗**
```python
import pandas as pd

data = pd.read_excel("info_table.xlsx")
data.fillna("无数据", inplace=True)  # 填充缺失值
data["到点"] = data["到点"].str.slice(0, 5)  # 标准化时间格式
```

### **2. 调用大模型生成答案**
```python
import requests

def call_llm(prompt):
    url = "https://api.siliconflow.ai/v1/chat/completions"
    headers = {"Authorization": "Bearer YOUR_API_KEY"}
    data = {"model": "Qwen3-8B", "messages": [{"role": "user", "content": prompt}]}
    response = requests.post(url, headers=headers, json=data)
    return response.json()["choices"][0]["message"]["content"]
```

---

## **七、总结**
核心要点：
1. **数据清洗**（时间、缺失值处理）。  
2. **高质量QA对生成**（编程生成问题+大模型生成答案）。  
3. **LoRA微调**（平衡速度与准确率）。  

**扩展应用**：可推广至其他结构化数据（如航班信息、库存管理等）的智能查询系统。

---

**参考资料**：
- [LoRA论文](https://arxiv.org/abs/2106.09685)  
- [Pandas官方文档](https://pandas.pydata.org/docs/)
